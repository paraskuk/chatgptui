<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Simple Web App to query Chat GPT any question you like</title>
       <!-- Load Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!--?      <link rel="stylesheet" href="style.css">-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', (event) => { hljs.highlightAll(); });</script>

  </head>
<style>
 body {
        display: flex;

        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
      }

      .container {
        max-height: 90vh;
        overflow-y: auto;
        padding: 1rem;
      }
    </style>
  <body>
  <div class="container">
    <h1>Simple Web App to query Chat GPT</h1>
<form>
  <label for="question">Enter your question:</label><br>
  <input type="text" id="question" name="user_input"><br>
  <br>
  <button type="button" onclick="sendRequest()">Submit</button>
</form>

<br>
<div id="answer">Answer will be shown here</div>
      </div>
  </body>
  <script>
      async function sendRequest() {
          const question = document.getElementsByName("user_input")[0].value;
          const response = await fetch('/ask_gpt4/', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                  user_input: question
              })
          });
          const data = await response.json();

          if (response.status === 200) {
              if ("response" in data) {
                  const answerElement = document.getElementById("answer");
                  answerElement.innerHTML = ''; // Clear previous content

                  // Apply PEP8 indentation to the GPT-3 response code
                  const formattedCode = applyPEP8Indentation(data.response);

                  // Create the code block with formatted code
                  const preElement = document.createElement('pre');
                  const codeElement = document.createElement('code');
                  codeElement.classList.add('language-python');
                  codeElement.innerHTML = formattedCode; // Use innerHTML to include indentation spans

                  preElement.appendChild(codeElement);
                  answerElement.appendChild(preElement);

                  // Check if Highlight.js is available and highlight the code
                  if (window.hljs) {
                      hljs.highlightElement(codeElement);
                  } else {
                      console.error('Highlight.js is not loaded.');
                  }
              } else if ("error" in data) {
                  document.getElementById("answer").innerHTML = `Error: ${data.error}`;
              } else {
                  document.getElementById("answer").innerHTML = "Unknown error.";
              }
          } else {
              document.getElementById("answer").innerHTML = "Server error.";
          }
      }

      function applyPEP8Indentation(code) {
          // Split the code into lines
          const lines = code.split('\n');

          // Apply indentation rules
          return lines.map(line => {
              // Count the leading spaces (assuming 4 spaces per indentation level for PEP 8)
              const indentLevel = line.search(/\S|$/) / 4;

              // Replace every 4 spaces with a specific amount of padding
              let indent = '';
              for (let i = 0; i < indentLevel; i++) {
                  indent += '<span class="indent">&nbsp;</span>';
              }

              // Remove the leading spaces and replace them with the indentation span
              return indent + line.trimStart();
          }).join('\n');
      }

  </script>

</html>